<!DOCTYPE html>
<html lang="en">
<head><script type="text/javascript" src="/___vscode_livepreview_injected_script"></script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="HOCHAT CAFE - Serving the best and budget-friendly in town. Premium food, great ambiance, and excellent service all in one place. Visit us at Gerona, Tarlac City.">
    <meta name="keywords" content="hochat cafe, HOCHAT CAFE, Gerona Restaurant, Cafe Gerona, Hochat, hochat">
    <meta name="author" content="HOCHAT CAFE">
    <link rel="icon" href="HOTCHAT CAFE/HOCHAT-CAFE LOGO-ICON.png" type="image/x-icon" />
    <title>Hochat Café - My Cart</title>
    <link href="https://fonts.googleapis.com/css2?family=BIZ+UDGothic:wght@400;700&display=swap" rel="stylesheet">
    <link rel = "stylesheet" href="CSS FILES/Cart.css">
</head>
<body>
    <!-- Header Section -->
    <header class="header">
        <a href = "HomePage.html">
            <img class="logo" src="HOTCHAT CAFE/HOCHAT CAFE LOGO.png" alt="Hochat Café Logo">
        <nav class="nav-menu">
            <a class="nav-item">HOME</a>
            <a class="nav-item">TRANSACTIONS</a>
            <a class="nav-item">ABOUT US</a>
            <a class="nav-item">CONTACT US</a>
            <a class="nav-item cart-highlight">ORDERS</a>
            <a class="logout-nav-item" id="logoutNavItem">LOGOUT</a>
        </nav>
        <div class="hamburger-menu" id="hamburgerMenu">
            <span></span>
            <span></span>
            <span></span>
        </div>
    </header>

    <!-- Mobile Sidebar Menu -->
    <div class="mobile-menu" id="mobileMenu">
        <button class="close-menu" id="closeMenu">×</button>
        <div class="menu-header">
            <img class="menu-logo" src="HOTCHAT CAFE/HOCHAT CAFE LOGO.png" alt="Hochat Cafe Logo">
        </div>
        <nav class="mobile-nav" id="mobileNav">
            <a class="mobile-nav-item">HOME</a>
            <a class="mobile-nav-item">TRANSACTIONS</a>
            <a class="mobile-nav-item">ABOUT US</a>
            <a class="mobile-nav-item">CONTACT US</a>
            <a class="mobile-nav-item cart-highlight">ORDERS</a>
            <a class="mobile-nav-item logout-mobile">LOGOUT</a>
        </nav>
    </div>

    <!-- Overlay -->
    <div class="overlay" id="overlay"></div>

    <!-- Main Content -->
    <main class="main-content">
        <div class="cart-container">
            <!-- Page Header with Back Button -->
            <div class="page-header">
                <h1 class="page-title">My Cart</h1>
                <button class="back-btn" id="backBtn">Back to Menu</button>
            </div>
            
            <div class="cart-layout">
                <!-- Left: Cart Items -->
                <div class="cart-items">
                    <h2 class="cart-section-title">Order Items</h2>
                    
                    <div id="cartItemsContainer">
                        <!-- Cart items will be dynamically inserted here -->
                        <div class="cart-item">
                            <img class="item-image-small" src="HOTCHAT CAFE/MENU PAGE IMAGES/MEALS/Chicken Bulgogi.jpg" alt="Chicken Bulgogi">
                            <div class="item-details">
                                <div class="item-name">Chicken Bulgogi</div>
                                <div class="item-price">₱ 105 each</div>
                            </div>
                            <div class="item-controls">
                                <div class="quantity-control">
                                    <button class="quantity-btn-small decrease-qty">-</button>
                                    <div class="quantity-display-small">2</div>
                                    <button class="quantity-btn-small increase-qty">+</button>
                                </div>
                                <div class="item-total">₱ 210</div>
                                <button class="remove-btn">×</button>
                            </div>
                        </div>
                        
                        <div class="cart-item">
                            <img class="item-image-small" src="HOTCHAT CAFE/MENU PAGE IMAGES/MEALS/Korean bowl.png" alt="Korean Bowl">
                            <div class="item-details">
                                <div class="item-name">Korean Bowl</div>
                                <div class="item-price">₱ 125 each</div>
                            </div>
                            <div class="item-controls">
                                <div class="quantity-control">
                                    <button class="quantity-btn-small decrease-qty">-</button>
                                    <div class="quantity-display-small">1</div>
                                    <button class="quantity-btn-small increase-qty">+</button>
                                </div>
                                <div class="item-total">₱ 125</div>
                                <button class="remove-btn">×</button>
                            </div>
                        </div>
                        
                        <div class="cart-item">
                            <img class="item-image-small" src="HOTCHAT CAFE/MENU PAGE IMAGES/MEALS/Katsu Curry.jpg" alt="Katsu Curry">
                            <div class="item-details">
                                <div class="item-name">Katsu Curry</div>
                                <div class="item-price">₱ 225 each</div>
                            </div>
                            <div class="item-controls">
                                <div class="quantity-control">
                                    <button class="quantity-btn-small decrease-qty">-</button>
                                    <div class="quantity-display-small">1</div>
                                    <button class="quantity-btn-small increase-qty">+</button>
                                </div>
                                <div class="item-total">₱ 225</div>
                                <button class="remove-btn">×</button>
                            </div>
                        </div>
                    </div>
                    
                    <div id="emptyCartMessage" class="empty-cart-message" style="display: none;">
                        Your cart is empty. Add some delicious items from our menu!
                    </div>
                </div>
                
                <!-- Right: Order Summary -->
                <div class="order-summary">
                    <h2 class="cart-section-title">Order Summary</h2>
                    
                    <div class="summary-row">
                        <span class="summary-label">Subtotal:</span>
                        <span class="summary-value" id="subtotal">₱ 560</span>
                    </div>
                    
                    <div class="summary-row">
                        <span class="summary-label">Delivery Fee:</span>
                        <span class="summary-value" id="deliveryFee">₱ 50</span>
                    </div>
                    
                    <div class="summary-total">
                        <span>Total:</span>
                        <span id="grandTotal">₱ 610</span>
                    </div>
                    
                    <button class="checkout-btn" id="checkoutBtn">
                        Proceed to Checkout
                    </button>
                    
                    <button class="continue-shopping-btn" id="continueShoppingBtn">
                        Continue Shopping
                    </button>
                </div>
            </div>
        </div>
    </main>

    <!-- Footer Section -->
    <footer class="footer">
        <div class="social-section">
            <div class="social-icons">
            <a href="https://www.facebook.com/HochatCafe" class="social-icon" target="_blank" rel="noopener noreferrer">
                    <img src="HOTCHAT CAFE/FACEBOOK_ICON.png" alt="Facebook">
                </a>
                <a href="https://www.instagram.com/hochatcafe" class="social-icon" target="_blank" rel="noopener noreferrer">
                    <img src="HOTCHAT CAFE/INSTAGRAM_ICON.png" alt="Instagram">
                </a>
            </div>
        </div>
    </footer>

    <script>
        // ========== USER DATA MANAGEMENT ==========
        
        // Get current user safely
        function getCurrentUser() {
            const user = JSON.parse(localStorage.getItem('currentUser'));
            if (!user) {
                // Redirect to login if no user
                window.location.href = 'index.html';
                return null;
            }
            return user;
        }
        
        // Get user-specific key
        function getUserKey() {
            const user = getCurrentUser();
            return user ? `user_${user.email}` : null;
        }
        
        // Get user data
        function getUserData() {
            const userKey = getUserKey();
            if (!userKey) return null;
            
            const data = localStorage.getItem(userKey);
            return data ? JSON.parse(data) : { cart: [], orders: [], favorites: [] };
        }
        
        // Save user data
        function saveUserData(data) {
            const userKey = getUserKey();
            if (userKey && data) {
                localStorage.setItem(userKey, JSON.stringify(data));
            }
        }
        
        // Get user cart
        function getUserCart() {
            const userData = getUserData();
            return userData ? userData.cart : [];
        }
        
        // Save user cart
        function saveUserCart(cart) {
            const userData = getUserData();
            if (userData) {
                userData.cart = cart;
                saveUserData(userData);
            }
        }
        
        // Get user orders
        function getUserOrders() {
            const userData = getUserData();
            return userData ? userData.orders : [];
        }
        
        // Save user order
        function saveUserOrder(order) {
            const userData = getUserData();
            if (userData) {
                userData.orders.push(order);
                saveUserData(userData);
            }
        }
        
        // Generate unique ID
        function generateOrderId() {
            const timestamp = Date.now();
            const random = Math.floor(Math.random() * 1000);
            return `HOCHAT-${timestamp}-${random}`;
        }
        
        // ========== MAIN CODE ==========
        
        // Check if user is logged in
        const currentUser = getCurrentUser();
        if (!currentUser) {
            alert('Please login to view your cart');
            window.location.href = 'index.html';
        }
        
        // Hamburger Menu Functionality
        const hamburgerMenu = document.getElementById('hamburgerMenu');
        const mobileMenu = document.getElementById('mobileMenu');
        const closeMenu = document.getElementById('closeMenu');
        const overlay = document.getElementById('overlay');
        const logoutNavItem = document.getElementById('logoutNavItem');
        const backBtn = document.getElementById('backBtn');
        const checkoutBtn = document.getElementById('checkoutBtn');
        const continueShoppingBtn = document.getElementById('continueShoppingBtn');
        const cartItemsContainer = document.getElementById('cartItemsContainer');
        const emptyCartMessage = document.getElementById('emptyCartMessage');
        
        // Initialize cart from USER-SPECIFIC storage
        let cartItems = getUserCart();
        
        // Calculate order summary
        function calculateOrderSummary() {
            const subtotal = cartItems.reduce((sum, item) => sum + (item.price * item.quantity), 0);
            const deliveryFee = 50;
            const grandTotal = subtotal + deliveryFee;
            
            // Update display
            document.getElementById('subtotal').textContent = `₱ ${subtotal}`;
            document.getElementById('deliveryFee').textContent = `₱ ${deliveryFee}`;
            document.getElementById('grandTotal').textContent = `₱ ${grandTotal}`;
            
            // Disable checkout button if cart is empty
            checkoutBtn.disabled = cartItems.length === 0;
            
            // Show/hide empty cart message
            if (cartItems.length === 0) {
                cartItemsContainer.style.display = 'none';
                emptyCartMessage.style.display = 'block';
            } else {
                cartItemsContainer.style.display = 'block';
                emptyCartMessage.style.display = 'none';
            }
        }
        
        // Render cart items
        function renderCartItems() {
            cartItemsContainer.innerHTML = '';
            
            cartItems.forEach((item, index) => {
                const cartItemHTML = `
                    <div class="cart-item" data-id="${item.id}">
                        <img class="item-image-small" src="${item.image}" alt="${item.name}">
                        <div class="item-details">
                            <div class="item-name">${item.name}</div>
                            <div class="item-price">₱ ${item.price} each</div>
                        </div>
                        <div class="item-controls">
                            <div class="quantity-control">
                                <button class="quantity-btn-small decrease-qty" data-index="${index}">-</button>
                                <div class="quantity-display-small">${item.quantity}</div>
                                <button class="quantity-btn-small increase-qty" data-index="${index}">+</button>
                            </div>
                            <div class="item-total">₱ ${item.price * item.quantity}</div>
                            <button class="remove-btn" data-index="${index}">×</button>
                        </div>
                    </div>
                `;
                cartItemsContainer.innerHTML += cartItemHTML;
            });
            
            calculateOrderSummary();
            saveUserCart(cartItems);
        }
        
        // Update item quantity
        function updateQuantity(index, change) {
            cartItems[index].quantity += change;
            
            // Remove item if quantity becomes 0
            if (cartItems[index].quantity <= 0) {
                cartItems.splice(index, 1);
            }
            
            renderCartItems();
        }
        
        // Remove item from cart
        function removeItem(index) {
            if (confirm(`Remove ${cartItems[index].name} from cart?`)) {
                cartItems.splice(index, 1);
                renderCartItems();
            }
        }
        
        // Save order to USER-SPECIFIC transactions
        function saveOrderToTransactions() {
            if (cartItems.length === 0) return null;
            
            const subtotal = cartItems.reduce((sum, item) => sum + (item.price * item.quantity), 0);
            const deliveryFee = 50;
            const grandTotal = subtotal + deliveryFee;
            
            // Create new order object
            const newOrder = {
                id: generateOrderId(),
                items: cartItems.map(item => ({
                    name: item.name,
                    quantity: item.quantity,
                    price: item.price,
                    total: item.price * item.quantity
                })),
                subtotal: subtotal,
                deliveryFee: deliveryFee,
                total: grandTotal,
                date: new Date().toISOString(),
                status: 'completed'
            };
            
            // Save to user's orders
            saveUserOrder(newOrder);
            
            return newOrder;
        }
        
        // Hamburger Menu
        hamburgerMenu.addEventListener('click', () => {
            mobileMenu.classList.add('active');
            overlay.classList.add('active');
        });
        
        closeMenu.addEventListener('click', () => {
            mobileMenu.classList.remove('active');
            overlay.classList.remove('active');
        });
        
        overlay.addEventListener('click', () => {
            mobileMenu.classList.remove('active');
            overlay.classList.remove('active');
        });
        
        // Navigation - CORRECTED
        document.querySelectorAll('.nav-item').forEach(item => {
            item.addEventListener('click', function() {
                const page = this.textContent;
                switch(page) {
                    case 'HOME':
                        window.location.href = 'HomePage.html';
                        break;
                    case 'TRANSACTIONS':
                        window.location.href = 'Transactions.html';
                        break;
                    case 'ABOUT US':
                        window.location.href = 'AboutUs.html';
                        break;
                    case 'CONTACT US':
                        window.location.href = 'ContactUs.html';
                        break;
                    case 'ORDERS':
                        // Already on cart page
                        break;
                }
            });
        });
        
        // Logout
        logoutNavItem.addEventListener('click', function() {
            if(confirm('Are you sure you want to log out?')) {
                localStorage.removeItem('currentUser');
                alert('Logged out successfully!');
                window.location.href = 'index.html';
            }
        });
        
        // Mobile menu navigation - CORRECTED
        document.querySelectorAll('.mobile-nav-item').forEach(item => {
            item.addEventListener('click', function() {
                if(this.classList.contains('logout-mobile')) {
                    if(confirm('Are you sure you want to log out?')) {
                        localStorage.removeItem('currentUser');
                        alert('Logged out successfully!');
                        window.location.href = 'index.html';
                    }
                } else {
                    const page = this.textContent;
                    switch(page) {
                        case 'HOME':
                            window.location.href = 'HomePage.html';
                            break;
                        case 'TRANSACTIONS':
                            window.location.href = 'Transactions.html';
                            break;
                        case 'ABOUT US':
                            window.location.href = 'AboutUs.html';
                            break;
                        case 'CONTACT US':
                            window.location.href = 'ContactUs.html';
                            break;
                        case 'ORDERS':
                            // Already on cart page
                            break;
                    }
                    mobileMenu.classList.remove('active');
                    overlay.classList.remove('active');
                }
            });
        });
        
        // Back button functionality - Goes to MenuPage.html
        backBtn.addEventListener('click', function() {
            window.location.href = 'MenuPage.html';
        });
        
        // Continue shopping button - Goes to MenuPage.html
        continueShoppingBtn.addEventListener('click', function() {
            window.location.href = 'MenuPage.html';
        });
        
        // Checkout button - SAVES TO USER'S TRANSACTIONS
        checkoutBtn.addEventListener('click', function() {
            if (cartItems.length === 0) {
                alert('Your cart is empty. Add some items first!');
                return;
            }
            
            const grandTotal = document.getElementById('grandTotal').textContent;
            const user = getCurrentUser();
            
            if (confirm(`Proceed to checkout? Total: ${grandTotal}`)) {
                // Save order to user's transactions
                const newOrder = saveOrderToTransactions();
                
                if (newOrder) {
                    alert(`Order placed successfully!\n\nOrder ID: ${newOrder.id}\nTotal: ${grandTotal}\n\nThank you for your order, ${user.firstName}!`);
                    
                    // Clear cart after successful checkout
                    cartItems = [];
                    saveUserCart(cartItems);
                    renderCartItems();
                }
            }
        });
        
        // Event delegation for dynamic cart item buttons
        cartItemsContainer.addEventListener('click', function(e) {
            // Decrease quantity
            if (e.target.classList.contains('decrease-qty')) {
                const index = parseInt(e.target.getAttribute('data-index'));
                updateQuantity(index, -1);
            }
            
            // Increase quantity
            if (e.target.classList.contains('increase-qty')) {
                const index = parseInt(e.target.getAttribute('data-index'));
                updateQuantity(index, 1);
            }
            
            // Remove item
            if (e.target.classList.contains('remove-btn')) {
                const index = parseInt(e.target.getAttribute('data-index'));
                removeItem(index);
            }
        });
        
        // ========== FIX: CLEAR CART ON FIRST VISIT ==========
        // This function checks if it's the user's first visit to cart page
        // and clears any existing items
        
        function clearCartOnFirstVisit() {
            // Check if this is the first time user visits cart page
            // We'll use a flag in localStorage to track if cart has been cleared for this session
            
            const userKey = getUserKey();
            const sessionFlag = `cart_cleared_${userKey}`;
            
            // Check if we've already cleared the cart for this session
            const cartAlreadyCleared = localStorage.getItem(sessionFlag);
            
            if (!cartAlreadyCleared) {
                // Clear the cart
                cartItems = [];
                saveUserCart(cartItems);
                
                // Set flag so we don't clear it again in this session
                localStorage.setItem(sessionFlag, 'true');
                console.log('Cart cleared for new user session');
            }
            
            // Optional: Clear the flag when user logs out
            // This is handled in the logout function above
        }
        
        // Clear the flag when user logs out (add to logout function)
        const originalLogout = logoutNavItem.onclick;
        logoutNavItem.onclick = function() {
            // Clear the session flag
            const userKey = getUserKey();
            if (userKey) {
                localStorage.removeItem(`cart_cleared_${userKey}`);
            }
            // Call original logout
            if(confirm('Are you sure you want to log out?')) {
                localStorage.removeItem('currentUser');
                alert('Logged out successfully!');
                window.location.href = 'index.html';
            }
        };
        
        // ========== SIMPLER ALTERNATIVE: JUST REMOVE THE SAMPLE DATA ==========
        // If you want users to always start with empty cart, just remove the initialization function
        
        // Initialize - WITHOUT sample data
        clearCartOnFirstVisit(); // Clear cart on first visit
        renderCartItems(); // Render the cart (should be empty)
    </script>
</body>
</html>